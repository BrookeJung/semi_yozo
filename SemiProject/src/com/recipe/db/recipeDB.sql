--DROP TABLE RECIPE_INFO;
DROP SEQUENCE RECIPE_ID_SEQ;
DROP SEQUENCE VIEW_SEQ;

CREATE SEQUENCE RECIPE_ID_SEQ;
--CREATE SEQUENCE VIEW_SEQ;

CREATE TABLE RECIPE_INFO(
   RECIPE_ID NUMBER PRIMARY KEY,--레시피코드
   RECIPE_NM_KO VARCHAR2(400),  --레시피이름
   SUMRY VARCHAR2(2000),        --간략소개
   NATION_CODE NUMBER,          --유형코드
   NATION_NM VARCHAR2(400),    --유형분류
   TY_CODE NUMBER,             --음식분류코드
   TY_NM VARCHAR2(500),       --음식분류
   COOKING_TIME VARCHAR2(500),  --조리시간
   CALORIE VARCHAR2(500),       --칼로리
   QNT VARCHAR2(500),           --분량
   LEVEL_NM VARCHAR2(500),       --난이도
   IRDNT_CODE VARCHAR2(500),    --재료별 분류명
   IMG_URL VARCHAR2(4000),      --대표이미지URL
   DET_URL VARCHAR2(4000)       --상세URL
  
   
);




--찜추가
ALTER TABLE RECIPE_INFO
ADD (PICK VARCHAR2(2));
--조회수추가
ALTER TABLE RECIPE_INFO
ADD (VIEWS NUMBER);
--제약조건 및 디폴트값
ALTER TABLE RECIPE_INFO
ADD CONSTRAINT RECIPE_INFO_CHECK_PICK CHECK(PICK IN('Y','N'));
ALTER TABLE RECIPE_INFO MODIFY(PICK DEFAULT 'N');
--NULL값 없데이트-
UPDATE RECIPE_INFO SET PICK='N'WHERE PICK is null;
UPDATE RECIPE_INFO SET VIEWS=0 WHERE VIEWS is null;

--SELECT * FROM RECIPE_INFO ORDER BY RECIPE_ID ASC;
SELECT * FROM RECIPE_INFO WHERE RECIPE_NM_KO='쇠고기양송이볶음' 

-------------------레시피재료--------------------------------

--DROP TABLE RECIPE_MATERIAL;

CREATE TABLE RECIPE_MATERIAL(
--   레시피코드
   RECIPE_ID NUMBER,
--   재료순번   
   IRDNT_SN NUMBER PRIMARY KEY,
--    재료명
   IRDNT_NM VARCHAR2(2000),
--    재료용량
   IRDNT_CPCTY VARCHAR2(2000),
--    재료타입 코드
   IRDNT_TY_CODE VARCHAR2(2000),
--    재료 타입명
   IRDNT_TY_NM VARCHAR2(2000)
);

--SELECT * FROM RECIPE_MATERIAL ORDER BY RECIPE_ID ASC;

-- 재료, 요리 테이블 RECIPE_ID 기본키 외래키 참조
ALTER TABLE RECIPE_MATERIAL ADD CONSTRAINT constraint_name FOREIGN KEY(RECIPE_ID) REFERENCES RECIPE_INFO(RECIPE_ID);


--------------------냉장고--------------------------------

--DROP TABLE MY_REFRIGERATOR;

CREATE TABLE MY_REFRIGERATOR(
	ID VARCHAR2(100) NOT NULL,
--    재료명
   	IRDNT_NM VARCHAR2(2000)
  
   

);
SELECT * FROM MY_REFRIGERATOR;

----------------- 레시피 과정-----------------------------------
DROP TABLE RECIPE_PROCESS

CREATE TABLE RECIPE_PROCESS(
-- 레시피 코드
	RECIPE_ID NUMBER,
-- 	요리설명순서
	COOKING_NO NUMBER,
--	요리설명
	COOKING_DC VARCHAR2(2000),
--  과정 이미지 URL
	STRE_STEP_IMAGE_URL VARCHAR2(4000),
--  과정팁
	STER_TIP VARCHAR2(4000)
)

SELECT * FROM RECIPE_PROCESS;
SELECT * FROM RECIPE_PROCESS WHERE RECIPE_ID=30;

--SELECT RECIPE_ID,count(*) AS count FROM RECIPE_MATERIAL INNER JOIN MY_REFRIGERATOR ON MY_REFRIGERATOR.IRDNT_NM = RECIPE_MATERIAL.IRDNT_NM group by RECIPE_MATERIAL.RECIPE_ID Order by count DESC
--SELECT RECIPE_ID FROM RECIPE_MATERIAL INNER JOIN MY_REFRIGERATOR ON MY_REFRIGERATOR.IRDNT_NM = RECIPE_MATERIAL.IRDNT_NM group by RECIPE_MATERIAL.RECIPE_ID Order by RECIPE_ID ASC


select * from (SELECT RECIPE_ID,count(*) AS count FROM RECIPE_MATERIAL INNER JOIN MY_REFRIGERATOR ON MY_REFRIGERATOR.IRDNT_NM = RECIPE_MATERIAL.IRDNT_NM group by RECIPE_MATERIAL.RECIPE_ID Order by count DESC) where rownum<=3
--최종


SELECT * FROM RECIPE_INFO WHERE RECIPE_ID IN(SELECT * FROM (SELECT RECIPE_ID FROM RECIPE_MATERIAL INNER JOIN MY_REFRIGERATOR ON 
 MY_REFRIGERATOR.IRDNT_NM = RECIPE_MATERIAL.IRDNT_NM WHERE ID='fake' GROUP BY RECIPE_MATERIAL.RECIPE_ID ORDER BY RECIPE_ID ASC) WHERE ROWNUM<=3)


